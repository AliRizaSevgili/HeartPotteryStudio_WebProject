<!-- Stepper/Progress Bar -->
<section aria-label="Checkout Progress" class="w-full">
  <div class="w-full max-w-2xl mx-auto flex justify-between items-center mt-40 mb-12">
    <div class="flex-1 flex flex-col items-center">
      <button id="step-cart-btn" type="button" class="focus:outline-none">
        <div id="step-cart" class="step-circle w-8 h-8 rounded-full bg-indigo-500 text-white font-bold">1</div>
      </button>
      <span class="mt-2 text-sm font-semibold text-indigo-700">Cart</span>
      <!-- Hata Kutucuğu -->
      <div id="cart-error" class="hidden bg-red-100 text-red-700 p-2 rounded mt-2 text-sm max-w-xs text-center">
        Please complete the Cart section before proceeding.
      </div>
    </div>
    <div class="flex-1 border-t-2 border-indigo-300 mx-2"></div>
    <div class="flex-1 flex flex-col items-center">
      <button id="step-delivery-btn" type="button" class="focus:outline-none">
        <div id="step-delivery" class="step-circle w-8 h-8 rounded-full bg-gray-200 text-gray-700 font-bold">2</div>
      </button>
      <span class="mt-2 text-sm font-semibold text-gray-700">Info</span>
      <!-- Hata Kutucuğu -->
      <div id="delivery-error" class="hidden bg-red-100 text-red-700 p-2 rounded mt-2 text-sm max-w-xs text-center">
        Please complete the Info section before proceeding.
      </div>
    </div>
    <div class="flex-1 border-t-2 border-indigo-300 mx-2"></div>
    <div class="flex-1 flex flex-col items-center">
      <button id="step-payment-btn" type="button" class="focus:outline-none">
        <div id="step-payment" class="step-circle w-8 h-8 rounded-full bg-gray-200 text-gray-700 font-bold">3</div>
      </button>
      <span class="mt-2 text-sm font-semibold text-gray-700">Payment</span>
      <!-- Hata Kutucuğu -->
      <div id="payment-error" class="hidden bg-red-100 text-red-700 p-2 rounded mt-2 text-sm max-w-xs text-center">
        Please complete the Payment section before proceeding.
      </div>
    </div>
  </div>
</section>

<!-- Error Message Container -->
<div id="progress-error" class="hidden bg-red-100 text-red-700 p-3 rounded mb-4 max-w-2xl mx-auto text-center opacity-0 pointer-events-none"></div>

<!-- Cart Section -->
<section>
  <div id="cart-section" class="container mx-auto mt-10">
    <div class="sm:flex shadow-md my-10">
      <div class="w-full sm:w-3/4 bg-white px-10 py-10">
        <div class="flex justify-between border-b pb-8">
          <h1 class="font-semibold text-2xl">Cart</h1>
          <h2 class="font-semibold text-2xl">
            {{#if cart.length}}
              {{cart.length}} Items
            {{else}}
              0 Items
            {{/if}}
          </h2>
        </div>
        {{#if selectedClass}}
        <!-- Seçilen slot ve class bilgileri -->
        <div class="md:flex items-stretch py-8 md:py-10 lg:py-8 border-t border-gray-50">
          <div class="md:w-4/12 2xl:w-1/4 w-full">
            <img src="{{selectedClass.image}}" alt="{{selectedClass.title}}" class="h-full object-center object-cover rounded-lg" />
          </div>
          <div class="md:pl-3 md:w-8/12 2xl:w-3/4 flex flex-col justify-center">
            <p class="text-base font-bold text-gray-800 mb-2">{{selectedClass.title}}</p>
            <p class="text-sm text-gray-600 mb-1"><strong>Day:</strong> {{selectedClass.slotDay}}</p>
            <p class="text-sm text-gray-600 mb-1"><strong>Date:</strong> {{selectedClass.slotDate}}</p>
            <p class="text-sm text-gray-600 mb-1"><strong>Time:</strong> {{selectedClass.slotTime}}</p>
            <div class="flex items-center justify-between pt-5">
              <div class="flex items-center">
                <p class="text-xs leading-3 underline text-gray-800 cursor-pointer">Add to favorites</p>
                <p class="text-xs leading-3 underline text-red-500 pl-5 cursor-pointer">Remove</p>
              </div>
              <p class="text-base font-black leading-none text-gray-800">{{selectedClass.price}}</p>
            </div>
          </div>
        </div>
        {{else}}
        <!-- Demo ürünler -->
        {{#if cart.length}}
          {{#each cart}}
            <div class="md:flex items-stretch py-8 md:py-10 lg:py-8 border-t border-gray-50">
              <div class="md:w-4/12 2xl:w-1/4 w-full">
                <img src="{{classImage}}" alt="{{classTitle}}" 
                     class="w-full h-auto object-center object-contain rounded-lg" />
              </div>
              <div class="md:pl-3 md:w-8/12 2xl:w-3/4 flex flex-col justify-center">
                <p class="text-base font-bold text-gray-800 mb-2">{{classTitle}}</p>
                <p class="text-sm text-gray-600 mb-1"><strong>Day:</strong> {{slotDay}}</p>
                <p class="text-sm text-gray-600 mb-1"><strong>Date:</strong> {{slotDate}}</p>
                <p class="text-sm text-gray-600 mb-1"><strong>Time:</strong> {{slotTime}}</p>
                <div class="flex items-center justify-between pt-5">
                  <p class="text-base font-black leading-none text-gray-800">{{classPrice}}</p>
                  <form method="POST" action="/remove-from-cart" class="ml-4">
                    <input type="hidden" name="classId" value="{{classId}}">
                    <input type="hidden" name="slotDay" value="{{slotDay}}">
                    <input type="hidden" name="slotDate" value="{{slotDate}}">
                    <input type="hidden" name="slotTime" value="{{slotTime}}">
                    <button type="submit" class="text-xs leading-3 underline text-red-500 cursor-pointer hover:text-red-700 transition">
                      Remove
                    </button>
                  </form>
                </div>
              </div>
            </div>
          {{/each}}
        {{else}}
          <p>Your cart is empty.</p>
        {{/if}}

        <a href="#" onclick="window.history.length > 1 ? history.back() : window.location.href='/learn'" class="flex font-semibold text-indigo-600 text-sm mt-10 transition-all duration-150 hover:text-indigo-800 hover:text-base">
          <svg class="fill-current mr-2 text-indigo-600 w-4" viewBox="0 0 448 512">
            <path d="M134.059 296H436c6.627 0 12-5.373 12-12v-56c0-6.627-5.373-12-12-12H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.569 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296z"/>
          </svg>
          Continue Shopping
        </a>
        {{/if}}
      </div>
      <div id="summary" class="w-full sm:w-1/4 md:w-1/2 px-8 py-10">
        <h1 class="font-semibold text-2xl border-b pb-8">Order Summary</h1>
        <div class="mt-8 mb-5">
          <!-- Order Summary -->
          <ul class="divide-y divide-gray-200">
            {{#each cart}}
              <li class="flex justify-between py-2">
                <span class="text-sm text-gray-700">{{classTitle}} ({{slotDate}} {{slotTime}})</span>
                <span class="text-sm font-semibold text-gray-900">{{classPrice}}</span>
              </li>
            {{/each}}
          </ul>
        </div>
        <div class="flex justify-between mt-10 mb-5">
          <span class="font-semibold text-sm uppercase">
            {{#if cart.length}}
              Items {{cart.length}}
            {{else}}
              Items 0
            {{/if}}
          </span>
          <span class="font-semibold text-sm">
            {{#if cart.length}}
              ${{sum cart "classPrice"}}
            {{else}}
              $0
            {{/if}}
          </span>
        </div>
        <form method="POST" action="/apply-promo" class="mb-2">
          <label for="promo" class="font-semibold inline-block mb-3 text-sm uppercase">
            Promo Code
          </label>
          <input
            type="text"
            id="promo"
            name="promo"
            placeholder="Enter your code"
            class="p-2 text-sm w-full"
          />
          <button class="bg-red-500 hover:bg-red-600 px-5 py-2 text-sm text-white uppercase mt-2" type="submit">
            Apply
          </button>
        </form>
        {{#if promoMessage}}
          <div class="text-xs text-indigo-700 mb-2">{{promoMessage}}</div>
        {{/if}}
        <div class="border-t mt-8">
          <div class="space-y-1 mb-4 mt-4">
            <div class="flex justify-between text-sm text-gray-700">
              <span>Subtotal</span>
              <span>
                {{#if cart.length}}
                  ${{sum cart "classPrice"}}
                {{else}}
                  $0
                {{/if}}
              </span>
            </div>
            <div class="flex justify-between text-sm text-gray-700">
              <span>Savings</span>
              <span>
                {{#if promo}}
                  -${{discountAmount cart promo.discount}}
                {{else}}
                  $0
                {{/if}}
              </span>
            </div>
            <!-- Canada GST satırı kaldırıldı -->
            <div class="flex justify-between text-sm text-gray-700">
              <span>Tax (HST 13%)</span>
              <span>
                ${{taxAmount cart 0.13}}
              </span>
            </div>
          </div>
          <div class="flex font-semibold justify-between py-6 text-sm uppercase">
            <span>Total cost</span>
            <span>
              {{#if promo}}
                ${{totalCost cart promo.discount 0.13}}
              {{else}}
                ${{totalCost cart 0 0.13}}
              {{/if}}
            </span>
          </div>
          <button id="go-to-delivery" class="bg-indigo-500 font-semibold hover:bg-indigo-600 py-3 text-sm text-white uppercase w-full">
            Checkout
          </button>
        </div>
      </div>
    </div>
  </div>
</section>




<!-- Delivery Details Section (başlangıçta gizli) -->
<section id="delivery-section" class="bg-white py-8 antialiased dark:bg-gray-900 md:py-16 hidden" style="margin-top:-80px;">
  <!-- Form -->
  <form id="checkout-info-form" action="/checkout-info" method="POST" class="mx-auto mt-4 max-w-xl sm:mt-6">
    <input type="hidden" name="_csrf" value="{{csrfToken}}">
    <div class="grid grid-cols-1 gap-x-12 gap-y-6 sm:grid-cols-2">
      <!-- First Name -->
      <div>
        <label for="firstName" class="block text-sm/6 font-semibold text-gray-500">First name</label>
        <div class="mt-2.5">
          <input
            type="text"
            name="firstName"
            id="firstName"
            placeholder="Enter your first name"
            autocomplete="given-name"
            required
            class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 border border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-pink-100 shadow-none appearance-none placeholder:text-gray-400 placeholder:text-sm transition-all duration-200"
          />
        </div>
        <p class="hidden text-pink-500 text-sm mt-1"></p> <!-- Hata mesajı -->
      </div>
      <!-- Last Name -->
      <div>
        <label for="lastName" class="block text-sm/6 font-semibold text-gray-500">Last name</label>
        <div class="mt-2.5">
          <input
            type="text"
            name="lastName"
            id="lastName"
            placeholder="Enter your last name"
            autocomplete="family-name"
            required
            class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 border border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-pink-100 shadow-none appearance-none placeholder:text-gray-400 placeholder:text-sm transition-all duration-200"
          />
        </div>
        <p class="hidden text-pink-500 text-sm mt-1"></p> <!-- Hata mesajı -->
      </div>
      <!-- Company -->
      <div class="sm:col-span-2">
        <label for="company" class="block text-sm/6 font-semibold text-gray-500">Company <span class="text-gray-400 font-normal">(optional)</span></label>
        <div class="mt-2.5">
          <input
            type="text"
            name="company"
            id="company"
            placeholder="Enter your company"
            autocomplete="organization"
            class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 border border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-pink-100 shadow-none appearance-none placeholder:text-gray-400 placeholder:text-sm transition-all duration-200"
          />
        </div>
      </div>
      <!-- Phone Number -->
      <div>
        <label for="contactNumber" class="block text-sm/6 font-semibold text-gray-500">Phone Number</label>
        <div class="relative mt-2.5">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-slate-600">
              <path fill-rule="evenodd" d="M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 0 1-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 0 0 6.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 0 1 1.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 0 1-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5Z" clip-rule="evenodd" />
          </div>
          <input
            id="contactNumber"
            name="contactNumber"
            type="tel"
            placeholder="e.g., +1 123-456-7890"
            class="peer w-full bg-transparent placeholder:text-slate-400 text-gray-700 text-sm border border-gray-300 rounded-md pr-3 pl-10 py-2 focus:outline-none focus:border-transparent focus:ring-2 focus:ring-pink-100 shadow-none appearance-none transition duration-200 ease-in-out"
            pattern="^\+\d{1,3}\s\d{1,3}-\d{3}-\d{4}$"
            title="Phone number must be in the format: +1 123-456-7890"
            maxlength="16"
            required
          />
        </div>
        <p class="hidden text-pink-500 text-sm mt-1"></p> <!-- Hata mesajı -->
      </div>
      <!-- Email -->
      <div>
        <label for="email" class="block text-sm/6 font-semibold text-gray-500">Email</label>
        <div class="mt-2.5">
          <input
            type="email"
            name="email"
            id="email"
            placeholder="Enter your email"
            autocomplete="email"
            required
            class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 border border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-pink-100 shadow-none appearance-none placeholder:text-gray-400 placeholder:text-sm transition-all duration-200"
          />
        </div>
        <p class="hidden text-pink-500 text-sm mt-1"></p> <!-- Hata mesajı -->
      </div>
      <!-- Address -->
      <div class="sm:col-span-2">
        <label for="address" class="block text-sm/6 font-semibold text-gray-500">Address</label>
        <div class="mt-2.5">
          <input
            type="text"
            name="address"
            id="address"
            placeholder="Enter your address"
            autocomplete="street-address"
            required
            class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 border border-gray-300 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-pink-100 shadow-none appearance-none placeholder:text-gray-400 placeholder:text-sm transition-all duration-200"
          />
        </div>
        <p class="hidden text-pink-500 text-sm mt-1"></p> <!-- Hata mesajı -->
      </div>
      <!-- Toggle -->
      <div class="flex gap-x-4 sm:col-span-2 mt-6">
        <label class="inline-flex items-center cursor-pointer">
          <!-- Gizli checkbox (peer) -->
          <input type="checkbox" class="sr-only peer" id="toggle-agreement" />

          <!-- Toggle çubuğu -->
          <div class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-pink-100 rounded-full 
                      peer-checked:after:translate-x-full 
                      rtl:peer-checked:after:-translate-x-full
                      peer-checked:after:border-white 
                      after:content-[''] after:absolute after:top-[2px] after:start-[2px] 
                      after:bg-white after:border-gray-300 after:border 
                      after:rounded-full after:h-5 after:w-5 after:transition-all 
                      peer-checked:bg-pink-200">
          </div>

          <!-- Açıklama metni -->
          <span class="ms-3 text-sm font-medium text-gray-700" id="switch-1-label">
            By selecting this, you agree to our
            <a href="#" class="font-semibold text-pink-400 hover:text-pink-500">privacy&nbsp;policy</a>.
          </span>
        </label>

        <!-- ❗ Hata mesajı -->
        <p id="toggle-error" class="mt-2 text-sm text-pink-500 hidden">
          Please agree to the privacy policy.
        </p>
      </div>
      <div class="mt-10 flex w-full">
        <div class="mx-auto flex gap-4" style="width:340px;">
          <button
            type="button"
            id="back-to-cart"
            class="rounded-md bg-white px-3 py-2 text-center text-base font-semibold text-gray-700 border border-gray-300 shadow-none hover:bg-gray-100 focus:outline-none focus:ring-0 transition-all duration-200"
            style="min-width:120px;"
          >
            Back to Cart
          </button>
          <button
            type="submit"
            id="pay-now-btn"
            class="rounded-md bg-[#f8dce2] px-3.5 py-2.5 text-center text-base font-semibold text-[#5a3a3c] shadow-none hover:bg-[#f4cdd7] focus:outline-none focus:ring-0 border-none transition-all duration-200"
            style="min-width:160px;"
          >
            Pay now 
          </button>
        </div>
      </div>
      <!-- Add this hidden input inside your form -->
      <input type="hidden" name="recaptchaToken" id="recaptchaToken">
    </div>
  </form>
</section>

<!-- Payment Section (başlangıçta gizli) -->
<section id="payment-section" class="bg-gray-100 py-20 px-6 hidden">
  <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden grid grid-cols-1 md:grid-cols-2">
    <!-- Checkout Form -->
    <div class="p-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-4">Payment Details</h2>
      <form class="space-y-5">
        <!-- Name on Card -->
        <div>
          <label for="cardName" class="block text-sm/6 font-semibold text-gray-500">Name on Card</label>
          <div class="mt-2.5">
            <input
              type="text"
              id="cardName"
              name="cardName"
              placeholder="Enter the name on your card"
              required
              class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 
                     border border-gray-300 
                     focus:border-transparent 
                     focus:outline-none focus:ring-2 focus:ring-pink-100 
                     shadow-none appearance-none 
                     placeholder:text-gray-400 placeholder:text-sm
                     transition-all duration-200"
            />
          </div>
        </div>

        <!-- Card Number -->
        <div>
          <label for="cardNumber" class="block text-sm/6 font-semibold text-gray-500">Card Number</label>
          <div class="mt-2.5">
            <input
              type="text"
              id="cardNumber"
              name="cardNumber"
              placeholder="1234 5678 9012 3456"
              required
              class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 
                     border border-gray-300 
                     focus:border-transparent 
                     focus:outline-none focus:ring-2 focus:ring-pink-100 
                     shadow-none appearance-none 
                     placeholder:text-gray-400 placeholder:text-sm
                     transition-all duration-200"
            />
          </div>
        </div>

        <!-- Expiry and CVC -->
        <div class="flex gap-4">
          <div class="w-1/2">
            <label for="expiry" class="block text-sm/6 font-semibold text-gray-500">Expiry</label>
            <div class="mt-2.5">
              <input
                type="text"
                id="expiry"
                name="expiry"
                placeholder="MM/YY"
                required
                class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 
                       border border-gray-300 
                       focus:border-transparent 
                       focus:outline-none focus:ring-2 focus:ring-pink-100 
                       shadow-none appearance-none 
                       placeholder:text-gray-400 placeholder:text-sm
                       transition-all duration-200"
              />
            </div>
          </div>
          <div class="w-1/2">
            <label for="cvc" class="block text-sm/6 font-semibold text-gray-500">CVC</label>
            <div class="mt-2.5">
              <input
                type="text"
                id="cvc"
                name="cvc"
                placeholder="123"
                required
                class="block w-full rounded-md bg-white px-3.5 py-2 text-base text-gray-700 
                       border border-gray-300 
                       focus:border-transparent 
                       focus:outline-none focus:ring-2 focus:ring-pink-100 
                       shadow-none appearance-none 
                       placeholder:text-gray-400 placeholder:text-sm
                       transition-all duration-200"
              />
            </div>
          </div>
        </div>

        <!-- Buttons -->
        <div class="flex gap-4 mt-8">
          <button
            type="button"
            id="back-to-delivery"
            class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded"
          >
            Back to Info
          </button>
          <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white text-lg py-3 rounded-lg transition">
            Pay 
          </button>
        </div>
        <p class="text-center text-gray-500 text-sm mt-4">🔒 Secure Payment. Your information is encrypted.</p>
      </form>
    </div>

    <!-- Payment Methods & Summary -->
    <div class="bg-gray-50 p-8 border-l border-gray-200">
      <h3 class="text-xl font-semibold text-gray-700 mb-6">Choose Payment Method</h3>

      <div class="space-y-4">
        <!-- Visa & Mastercard -->
        <div class="flex items-center p-3 bg-white rounded-lg shadow-sm border hover:shadow-md transition">
          <img src="https://res.cloudinary.com/dnemf1asq/image/upload/v1753052690/Visa.svg_xtirgr.png" class="h-5 mr-3" alt="Visa" />
          <img src="https://res.cloudinary.com/dnemf1asq/image/upload/v1753052688/Mastercard-logo.svg_shnyvd.png" class="h-5 mr-3" alt="Mastercard" />
          <p class="text-gray-700 font-medium text-sm">Credit / Debit Card</p>
        </div>

        <!-- Google Pay -->
        <div id="google-pay-button" class="flex items-center p-3 bg-white rounded-lg shadow-sm border hover:shadow-md transition">
          <img src="https://res.cloudinary.com/dnemf1asq/image/upload/v1753053036/Google_Pay_Logo.svg_pntpzz.png" class="h-5 mr-3" alt="Google Pay" />
          <p class="text-gray-700 font-medium text-sm">Google Pay</p>
        </div>

        <!-- Apple Pay -->
        <div id="apple-pay-button" class="flex items-center p-3 bg-white rounded-lg shadow-sm border hover:shadow-md transition">
          <img src="https://res.cloudinary.com/dnemf1asq/image/upload/v1753053035/Apple_Pay_logo.svg_rwuopy.png" class="h-5 mr-3" alt="Apple Pay" />
          <p class="text-gray-700 font-medium text-sm">Apple Pay</p>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="mt-10 border-t pt-6">
        <h4 class="text-gray-700 font-semibold mb-2">Order Summary</h4>
        <div class="flex justify-between text-gray-600">
          <span>Subtotal</span>
          <span>
            {{#if cart.length}}
              ${{sum cart "classPrice"}}
            {{else}}
              $0.00
            {{/if}}
          </span>
        </div>
        <div class="flex justify-between text-gray-600 mt-1">
          <span>Savings</span>
          <span>
            {{#if promo}}
              -${{discountAmount cart promo.discount}}
            {{else}}
              $0.00
            {{/if}}
          </span>
        </div>
        <div class="flex justify-between text-gray-600 mt-1">
          <span>Tax (HST 13%)</span>
          <span>
            {{#if cart.length}}
              ${{taxAmount cart 0.13}}
            {{else}}
              $0.00
            {{/if}}
          </span>
        </div>
        <div class="flex justify-between text-lg font-bold text-gray-800 mt-4">
          <span>Total</span>
          <span>
            {{#if promo}}
              ${{totalCost cart promo.discount 0.13}}
            {{else}}
              ${{totalCost cart 0 0.13}}
            {{/if}}
          </span>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="/js/checkout_steps.js"></script>
<script src="https://www.google.com/recaptcha/api.js?render=6Lfk1X0rAAAAABIekRWzhhzOs9yqkXroGTCmhmmI"></script>
<script>
  
document.addEventListener("DOMContentLoaded", function() {
  const form = document.querySelector("form[action='/checkout-info']");
  const toggle = document.getElementById("toggle-agreement");
  const toggleError = document.getElementById("toggle-error");
  const deliverySection = document.getElementById("delivery-section");
  const paymentSection = document.getElementById("payment-section");
  const cartSection = document.getElementById("cart-section");
  const stepCart = document.getElementById("step-cart");
  const stepDelivery = document.getElementById("step-delivery");
  const stepPayment = document.getElementById("step-payment");
  const stepCartBtn = document.getElementById("step-cart-btn");
  const stepDeliveryBtn = document.getElementById("step-delivery-btn");
  const stepPaymentBtn = document.getElementById("step-payment-btn");
  const progressError = document.getElementById('progress-error');

  let currentStep = 1; // Track the current step (1 = Cart, 2 = Info, 3 = Payment)

  // Disable direct navigation to steps 2 or 3
  stepCartBtn.addEventListener("click", function(e) {
    e.preventDefault(); // Prevent default behavior
    if (currentStep === 1) {
      cartSection.classList.remove("hidden");
      deliverySection.classList.add("hidden");
      paymentSection.classList.add("hidden");
      updateProgressBar(1);
    }
  });

  stepDeliveryBtn.addEventListener("click", function(e) {
    e.preventDefault(); // Prevent default behavior
    if (currentStep === 2) {
      cartSection.classList.add("hidden");
      deliverySection.classList.remove("hidden");
      paymentSection.classList.add("hidden");
      updateProgressBar(2);
    } else {
      showError("Please complete the Cart section before proceeding to Info.");
    }
  });

  stepPaymentBtn.addEventListener("click", function(e) {
    e.preventDefault(); // Prevent default behavior
    if (currentStep === 3) {
      cartSection.classList.add("hidden");
      deliverySection.classList.add("hidden");
      paymentSection.classList.remove("hidden");
      updateProgressBar(3);
    } else if (currentStep === 2) {
      showError("Please complete the Info section before proceeding to Payment.");
    } else {
      showError("Please complete the Cart section before proceeding to Payment.");
    }
  });

  // Handle form submission for step 2 (Info)
  if (form) {
    form.onsubmit = null;
    form.addEventListener("submit", function(e) {
      // Toggle validation
      if (toggle && !toggle.checked) {
        if (toggleError) toggleError.classList.remove("hidden");
        e.preventDefault();
        return;
      } else {
        if (toggleError) toggleError.classList.add("hidden");
      }

      e.preventDefault();
      grecaptcha.ready(function() {
        grecaptcha.execute('6Lfk1X0rAAAAABIekRWzhhzOs9yqkXroGTCmhmmI', { action: 'submit' }).then(function(token) {
          document.getElementById('recaptchaToken').value = token;

          // Simulate successful form submission
          deliverySection.classList.add("hidden");
          paymentSection.classList.remove("hidden");
          currentStep = 3; // Move to step 3
          updateProgressBar(3);

          form.submit(); // Submit the form
        });
      });
    });
  }

  // Update the progress bar based on the current step
  function updateProgressBar(step) {
    if (step === 1) {
      stepCart.classList.add("bg-indigo-500", "text-white");
      stepCart.classList.remove("bg-gray-200", "text-gray-700");
      stepDelivery.classList.add("bg-gray-200", "text-gray-700");
      stepDelivery.classList.remove("bg-indigo-500", "text-white");
      stepPayment.classList.add("bg-gray-200", "text-gray-700");
      stepPayment.classList.remove("bg-indigo-500", "text-white");
    } else if (step === 2) {
      stepCart.classList.add("bg-gray-200", "text-gray-700");
      stepCart.classList.remove("bg-indigo-500", "text-white");
      stepDelivery.classList.add("bg-indigo-500", "text-white");
      stepDelivery.classList.remove("bg-gray-200", "text-gray-700");
      stepPayment.classList.add("bg-gray-200", "text-gray-700");
      stepPayment.classList.remove("bg-indigo-500", "text-white");
    } else if (step === 3) {
      stepCart.classList.add("bg-gray-200", "text-gray-700");
      stepCart.classList.remove("bg-indigo-500", "text-white");
      stepDelivery.classList.add("bg-gray-200", "text-gray-700");
      stepDelivery.classList.remove("bg-indigo-500", "text-white");
      stepPayment.classList.add("bg-indigo-500", "text-white");
      stepPayment.classList.remove("bg-gray-200", "text-gray-700");
    }
  }

  // Initialize the progress bar to step 1
  updateProgressBar(1);

  function showError(message) {
    // Hata mesajını tamamen devre dışı bırakmak için bu fonksiyon boş bırakıldı.
  }
});
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const deliverySection = document.getElementById("delivery-section");
  const paymentSection = document.getElementById("payment-section");
  const backToDeliveryButton = document.getElementById("back-to-delivery");

  // Back to Info button functionality
  if (backToDeliveryButton) {
    backToDeliveryButton.addEventListener("click", function() {
      if (deliverySection && paymentSection) {
        paymentSection.classList.add("hidden");
        deliverySection.classList.remove("hidden");
        window.scrollTo({ top: deliverySection.offsetTop - 40, behavior: "smooth" });
      }
    });
  }
});
</script>